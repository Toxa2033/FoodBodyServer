{"version":3,"sources":["../../../../../src/javascripts/ng-admin/Crud/field/maChoiceField.js"],"names":["maChoiceField","updateChoices","scope","choices","$root","$$phase","$digest","$compile","restrict","compile","pre","element","field","attributes","placeholder","name","v","validation","$watch","newValue","oldValue","undefined","value","refreshAttributes","itemsFilter","type","indexOf","remoteComplete","refreshDelay","remoteCompleteOptions","template","entry","html","select","children","setAttribute","contents","post","$on","e","data","$inject"],"mappings":";;;;;kBAKwBA,a;AALxB,SAASC,aAAT,CAAuBC,KAAvB,EAA8BC,OAA9B,EAAuC;AACnCD,UAAMC,OAAN,GAAgBA,OAAhB;AACAD,UAAME,KAAN,CAAYC,OAAZ,IAAuBH,MAAMI,OAAN,EAAvB;AACH;;AAEc,SAASN,aAAT,CAAuBO,QAAvB,EAAiC;AAC5C,WAAO;AACHL,eAAO;AACH,qBAAS,GADN;AAEH,qBAAS,GAFN;AAGH,qBAAU,IAHP;AAIH,yBAAa,IAJV;AAKH,uBAAW,GALR;AAMH,uBAAW;AANR,SADJ;AASHM,kBAAU,GATP;AAUHC,iBAAS,mBAAW;AAChB,mBAAO;AACHC,qBAAK,aAASR,KAAT,EAAgBS,OAAhB,EAAyB;AAC1B,wBAAIC,QAAQV,MAAMU,KAAN,EAAZ;AACA,wBAAIC,aAAaD,MAAMC,UAAN,EAAjB;AACAX,0BAAMY,WAAN,GAAqBD,cAAcA,WAAWC,WAA1B,IAA0C,eAA9D;AACAZ,0BAAMa,IAAN,GAAaH,MAAMG,IAAN,EAAb;AACAb,0BAAMc,CAAN,GAAUJ,MAAMK,UAAN,EAAV;AACAf,0BAAMgB,MAAN,CAAa,OAAb,EAAsB,UAASC,QAAT,EAAmBC,QAAnB,EAA6B;AAC/C,4BAAID,aAAaC,QAAb,IAAyBD,aAAaE,SAA1C,EAAqD;AACjD;AACAnB,kCAAMoB,KAAN,GAAc,IAAd;AACH;AACJ,qBALD;;AAOA,wBAAIC,oBAAoB,EAAxB;AACA,wBAAIC,cAAc,mCAAlB;AACA,wBAAIZ,MAAMa,IAAN,GAAaC,OAAb,CAAqB,WAArB,MAAsC,CAAtC,IAA2Cd,MAAMe,cAAN,EAA/C,EAAuE;AAAE;AACrEzB,8BAAM0B,YAAN,GAAqBhB,MAAMiB,qBAAN,GAA8BD,YAAnD;AACAL,4CAAoB,6EAApB;AACAC,sCAAc,EAAd;AACH;;AAED,wBAAIrB,UAAW,OAAOD,MAAMC,OAAb,IAAwB,UAAxB,IAAsCD,MAAMC,OAAN,EAAvC,GAA0DD,MAAMC,OAAN,EAA1D,GAA6ES,MAAMT,OAAN,GAAgBS,MAAMT,OAAN,EAAhB,GAAkC,EAA7H;;AAEA,wBAAI2B,+WAGyBP,iBAHzB,+CAGoFC,WAHpF,8KAAJ;;AAQAtB,0BAAMC,OAAN,GAAgB,OAAOA,OAAP,KAAoB,UAApB,GAAiCA,QAAQD,MAAM6B,KAAd,CAAjC,GAAwD5B,OAAxE;AACAQ,4BAAQqB,IAAR,CAAaF,QAAb;;AAEA,wBAAIG,SAAStB,QAAQuB,QAAR,GAAmB,CAAnB,CAAb;AACA,yBAAK,IAAInB,IAAT,IAAiBF,UAAjB,EAA6B;AACzBoB,+BAAOE,YAAP,CAAoBpB,IAApB,EAA0BF,WAAWE,IAAX,CAA1B;AACH;;AAEDR,6BAASI,QAAQyB,QAAR,EAAT,EAA6BlC,KAA7B;AACH,iBAzCE;AA0CHmC,sBAAM,cAASnC,KAAT,EAAgB;AAClBA,0BAAMoC,GAAN,CAAU,gBAAV,EAA4B,UAASC,CAAT,EAAYC,IAAZ,EAAkB;AAC1CvC,sCAAcC,KAAd,EAAqBsC,KAAKrC,OAA1B;AACH,qBAFD;AAGH;AA9CE,aAAP;AAgDH;AA3DE,KAAP;AA6DH;;AAEDH,cAAcyC,OAAd,GAAwB,CAAC,UAAD,CAAxB","file":"maChoiceField.js","sourcesContent":["function updateChoices(scope, choices) {\n    scope.choices = choices;\n    scope.$root.$$phase || scope.$digest();\n}\n\nexport default function maChoiceField($compile) {\n    return {\n        scope: {\n            'field': '&',\n            'value': '=',\n            'entry':  '=?',\n            'datastore': '&?',\n            'refresh': '&',\n            'choices': '&?'\n        },\n        restrict: 'E',\n        compile: function() {\n            return {\n                pre: function(scope, element) {\n                    var field = scope.field();\n                    var attributes = field.attributes();\n                    scope.placeholder = (attributes && attributes.placeholder) || 'FILTER_VALUES';\n                    scope.name = field.name();\n                    scope.v = field.validation();\n                    scope.$watch('value', function(newValue, oldValue) {\n                        if (newValue !== oldValue && newValue === undefined) {\n                            // fix for https://github.com/angular-ui/ui-select/issues/863\n                            scope.value = null;\n                        }\n                    });\n\n                    var refreshAttributes = '';\n                    var itemsFilter = '| filter: {label: $select.search}';\n                    if (field.type().indexOf('reference') === 0 && field.remoteComplete()) { // FIXME wrong place to do that\n                        scope.refreshDelay = field.remoteCompleteOptions().refreshDelay;\n                        refreshAttributes = 'refresh-delay=\"refreshDelay\" refresh=\"refresh({ $search: $select.search })\"';\n                        itemsFilter = '';\n                    }\n\n                    var choices = (typeof scope.choices == 'function' && scope.choices()) ? scope.choices() : (field.choices ? field.choices() : []);\n\n                    var template = `\n                        <ui-select ng-model=\"$parent.value\" ng-required=\"v.required\" id=\"{{ name }}\" name=\"{{ name }}\">\n                            <ui-select-match allow-clear=\"{{ !v.required }}\" placeholder=\"{{ placeholder | translate }}\">{{ $select.selected.label | translate }}</ui-select-match>\n                            <ui-select-choices ${refreshAttributes} repeat=\"item.value as item in choices ${itemsFilter}  track by $index\">\n                                {{ item.label | translate }}\n                            </ui-select-choices>\n                        </ui-select>`;\n\n                    scope.choices = typeof(choices) === 'function' ? choices(scope.entry) : choices;\n                    element.html(template);\n\n                    var select = element.children()[0];\n                    for (var name in attributes) {\n                        select.setAttribute(name, attributes[name]);\n                    }\n\n                    $compile(element.contents())(scope);\n                },\n                post: function(scope) {\n                    scope.$on('choices:update', function(e, data) {\n                        updateChoices(scope, data.choices);\n                    });\n                }\n            };\n        }\n    };\n}\n\nmaChoiceField.$inject = ['$compile'];\n"]}