{"version":3,"sources":["../../../../../../src/javascripts/test/unit/Crud/field/maChoiceFieldSpec.js"],"names":["describe","directive","require","ChoiceField","angular","module","filter","text","$compile","scope","directiveUsage","beforeEach","mock","inject","_$compile_","_$rootScope_","it","field","element","$digest","uiSelect","children","expect","classList","contains","toBeTruthy","attributes","disabled","getAttribute","test","isRequired","expectedAllowClearValue","validation","required","querySelector","toEqual","toString","choices","label","value","controller","toJson","items","JSON","stringify","entry","choicesFuncWasCalled","moo","selected"],"mappings":"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","file":"maChoiceFieldSpec.js","sourcesContent":["/*global angular,inject,describe,it,expect,beforeEach*/\ndescribe('directive: choice-field', function () {\n    'use strict';\n\n    var directive = require('../../../../ng-admin/Crud/field/maChoiceField');\n    var ChoiceField = require('admin-config/lib/Field/ChoiceField');\n\n    angular.module('testapp_ChoiceField', ['ui.select'])\n        .filter('translate', () => text => text)\n        .directive('maChoiceField', directive);\n\n    var $compile,\n        scope,\n        directiveUsage = '<ma-choice-field entry=\"entry\" field=\"field\" value=\"value\"></ma-choice-field>';\n\n    beforeEach(angular.mock.module('testapp_ChoiceField'));\n\n    beforeEach(inject(function (_$compile_, _$rootScope_) {\n        $compile = _$compile_;\n        scope = _$rootScope_;\n    }));\n\n    it(\"should contain a ui-select tag\", function () {\n        scope.field = new ChoiceField();\n        var element = $compile(directiveUsage)(scope);\n        scope.$digest();\n\n        var uiSelect = element.children()[0];\n        expect(uiSelect.classList.contains('ui-select-container')).toBeTruthy();\n    });\n\n    it(\"should add any supplied attribute\", function () {\n        scope.field = new ChoiceField().attributes({ disabled: true });\n        var element = $compile(directiveUsage)(scope);\n        scope.$digest();\n        expect(element.children()[0].getAttribute('disabled')).toBeTruthy();\n    });\n\n    it('should allow to remove selected option only if not required', function() {\n        function test(isRequired, expectedAllowClearValue) {\n            scope.field = new ChoiceField().validation({ required: isRequired });\n            var element = $compile(directiveUsage)(scope);\n            scope.$digest();\n\n            expect(element[0].querySelector('.ui-select-match').getAttribute('allow-clear')).toEqual(expectedAllowClearValue.toString());\n        }\n\n        test(true, false);\n        test(false, true);\n    });\n\n    it(\"should contain the choices as options\", function () {\n        scope.field = new ChoiceField().choices([\n            {label: 'foo', value: 'bar'},\n            {label: 'baz', value: 'bazValue'}\n        ]);\n\n        var element = $compile(directiveUsage)(scope);\n        scope.$digest();\n\n        var uiSelect = angular.element(element.children()[0]).controller('uiSelect');\n        expect(angular.toJson(uiSelect.items)).toEqual(JSON.stringify([\n            {label: 'foo', value: 'bar'},\n            {label: 'baz', value: 'bazValue'}\n        ]));\n    });\n\n    it(\"should contain the choices from choicesFunc as options\", function () {\n        var choices = [\n            {label: 'foo', value: 'bar'},\n            {label: 'baz', value: 'bazValue'}\n        ];\n\n        scope.field = new ChoiceField().choices(function(entry){\n            return choices;\n        });\n\n        var element = $compile(directiveUsage)(scope);\n        scope.$digest();\n\n        var uiSelect = angular.element(element.children()[0]).controller('uiSelect');\n        expect(angular.toJson(uiSelect.items)).toEqual(JSON.stringify([\n            {label: 'foo', value: 'bar'},\n            {label: 'baz', value: 'bazValue'}\n        ]));\n    });\n\n    it(\"should pass entry to choicesFunc\", function () {\n        var choices = [];\n        var choicesFuncWasCalled = false;\n\n        scope.entry = {moo: 'boo'};\n        scope.field = new ChoiceField().choices(function(entry){\n            expect(entry.moo).toEqual('boo');\n            choicesFuncWasCalled = true;\n            return choices;\n        });\n\n        $compile(directiveUsage)(scope);\n        scope.$digest();\n\n        expect(choicesFuncWasCalled).toBeTruthy();\n    });\n\n    it(\"should have the option with the bounded value selected\", function () {\n        scope.field = new ChoiceField().choices([\n            {label: 'foo', value: 'bar'},\n            {label: 'baz', value: 'bazValue'}\n        ]);\n\n        scope.value = 'bazValue';\n\n        var element = $compile(directiveUsage)(scope);\n        scope.$digest();\n\n        var uiSelect = angular.element(element.children()[0]).controller('uiSelect');\n        expect(angular.toJson(uiSelect.selected)).toEqual(JSON.stringify({\n            label: 'baz',\n            value: 'bazValue'\n        }));\n    });\n});\n"]}